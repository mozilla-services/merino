<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="HTTP mocking library that allows you to simulate responses from HTTP based services."><meta name="keywords" content="rust, rustlang, rust-lang, httpmock"><title>httpmock - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../httpmock/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate httpmock</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.5.8</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all httpmock's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="httpmock" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">httpmock</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/httpmock/lib.rs.html#1-1511" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>HTTP mocking library that allows you to simulate responses from HTTP based services.</p>
<h2 id="features" class="section-header"><a href="#features">Features</a></h2>
<ul>
<li>Simple, expressive, fluent API.</li>
<li>Many built-in helpers for easy request matching.</li>
<li>Parallel test execution.</li>
<li>Extensible request matching.</li>
<li>Fully asynchronous core with synchronous and asynchronous APIs.</li>
<li>Debugging support</li>
<li>Standalone mode with an accompanying <a href="https://hub.docker.com/r/alexliesenfeld/httpmock">Docker image</a>.</li>
<li>Network delay simulation</li>
<li>Support for <a href="type.Regex.html">Regex</a> matching, JSON, <a href="https://crates.io/crates/serde">serde</a>, cookies, and more.</li>
</ul>
<h2 id="getting-started" class="section-header"><a href="#getting-started">Getting Started</a></h2>
<p>Add <code>httpmock</code> to <code>Cargo.toml</code>:</p>
<div class="example-wrap"><pre class="language-toml"><code>[dev-dependencies]
httpmock = &quot;0.5&quot;</code></pre></div>
<p>You can then use <code>httpmock</code> as follows:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">httpmock::MockServer</span>;
<span class="kw">use</span> <span class="ident">httpmock::Method::GET</span>;

<span class="comment">// Start a lightweight mock server.</span>
<span class="kw">let</span> <span class="ident">server</span> <span class="op">=</span> <span class="ident">MockServer::start</span>();

<span class="comment">// Create a mock on the server.</span>
<span class="kw">let</span> <span class="ident">hello_mock</span> <span class="op">=</span> <span class="ident">server</span>.<span class="ident">mock</span>(<span class="op">|</span><span class="ident">when</span>, <span class="ident">then</span><span class="op">|</span> {
    <span class="ident">when</span>.<span class="ident">method</span>(<span class="ident">GET</span>)
        .<span class="ident">path</span>(<span class="string">&quot;/translate&quot;</span>)
        .<span class="ident">query_param</span>(<span class="string">&quot;word&quot;</span>, <span class="string">&quot;hello&quot;</span>);
    <span class="ident">then</span>.<span class="ident">status</span>(<span class="number">200</span>)
        .<span class="ident">header</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>)
        .<span class="ident">body</span>(<span class="string">&quot;ohi&quot;</span>);
});

<span class="comment">// Send an HTTP request to the mock server. This simulates your code.</span>
<span class="kw">let</span> <span class="ident">response</span> <span class="op">=</span> <span class="ident">isahc::get</span>(<span class="ident">server</span>.<span class="ident">url</span>(<span class="string">&quot;/translate?word=hello&quot;</span>)).<span class="ident">unwrap</span>();

<span class="comment">// Ensure the specified mock was called exactly one time (or fail with a detailed error description).</span>
<span class="ident">hello_mock</span>.<span class="ident">assert</span>();
<span class="comment">// Ensure the mock server did respond as specified.</span>
<span class="macro">assert_eq!</span>(<span class="ident">response</span>.<span class="ident">status</span>(), <span class="number">200</span>);</code></pre></div>
<h2 id="usage" class="section-header"><a href="#usage">Usage</a></h2>
<p>To be able to configure mocks, you first need to start a mock server by calling
<a href="struct.MockServer.html#method.start">MockServer::start</a>.
This will spin up a lightweight HTTP
mock server in the background and wait until the server is ready to accept requests.</p>
<p>You can then create a <a href="struct.Mock.html">Mock</a> object on the server by using the
<a href="struct.MockServer.html#method.mock">MockServer::mock</a> method. This method expects a closure
with two parameters, that we will refer to as the <code>when</code> and <code>then</code> parameter:</p>
<ul>
<li>The <code>when</code> parameter is of type <a href="struct.When.html">When</a> and holds all request characteristics.
The mock server will only respond to HTTP requests that meet all the criteria. Otherwise it
will respond with HTTP status code <code>404</code> and an error message.</li>
<li>The <code>then</code> parameter is of type <a href="struct.Then.html">Then</a> and holds all values that the mock
server will respond with.</li>
</ul>
<h2 id="sync--async" class="section-header"><a href="#sync--async">Sync / Async</a></h2>
<p>The internal implementation of <code>httpmock</code> is completely asynchronous. It provides you a
synchronous and an asynchronous API though. If you want to schedule awaiting operations manually, then
you can use the <code>async</code> variants that exist for every potentially blocking operation. For
example, there is <a href="struct.MockServer.html#method.start_async">MockServer::start_async</a> as an
asynchronous counterpart to <a href="struct.MockServer.html#method.start">MockServer::start</a>. You can
find similar methods throughout the entire library.</p>
<h2 id="parallelism" class="section-header"><a href="#parallelism">Parallelism</a></h2>
<p>To balance execution speed and resource consumption, <a href="struct.MockServer.html">MockServer</a>s
are kept in a server pool internally. This allows to run tests in parallel without overwhelming
the executing machine by creating too many HTTP servers. A test will be blocked if it tries to
use a <a href="struct.MockServer.html">MockServer</a> (e.g. by calling
<a href="struct.MockServer.html#method.start">MockServer::start</a>) while the server pool is empty
(i.e. all servers are occupied by other tests).</p>
<p><a href="struct.MockServer.html">MockServer</a>s are never recreated but recycled/resetted.
The pool is filled on demand up to a maximum number of 25 servers.
You can override this number by using the environment variable <code>HTTPMOCK_MAX_SERVERS</code>.</p>
<h2 id="debugging" class="section-header"><a href="#debugging">Debugging</a></h2>
<p><code>httpmock</code> logs against the <a href="https://crates.io/crates/log">log</a> crate. This allows you to
see detailed log output that contains information about <code>httpmock</code>s behaviour.
You can use this log output to investigate
issues, such as to find out why a request does not match a mock definition.</p>
<p>The most useful log level is <code>debug</code>, but you can also go down to <code>trace</code> to see even more
information.</p>
<p><strong>Attention</strong>: To be able to see the log output, you need to add the <code>--nocapture</code> argument
when starting test execution!</p>
<p><em>Hint</em>: If you use the <code>env_logger</code> backend, you need to set the <code>RUST_LOG</code> environment variable to
<code>httpmock=debug</code>.</p>
<h2 id="api-alternatives" class="section-header"><a href="#api-alternatives">API Alternatives</a></h2>
<p>This library provides two functionally interchangeable DSL APIs that allow you to create
mocks on the server. You can choose the one you like best or use both side-by-side. For a
consistent look, it is recommended to stick to one of them, though.</p>
<h3 id="whenthen-api" class="section-header"><a href="#whenthen-api">When/Then API</a></h3>
<p>This is the default API of <code>httpmock</code>. It is concise and easy to read. The main goal
is to reduce overhead emposed by this library to a bare minimum. It works well with
formatting tools, such as <a href="https://crates.io/crates/rustfmt">rustfmt</a> (i.e. <code>cargo fmt</code>),
and can fully benefit from IDE support.</p>
<h4 id="example" class="section-header"><a href="#example">Example</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let</span> <span class="ident">server</span> <span class="op">=</span> <span class="ident">httpmock::MockServer::start</span>();

<span class="kw">let</span> <span class="ident">greeting_mock</span> <span class="op">=</span> <span class="ident">server</span>.<span class="ident">mock</span>(<span class="op">|</span><span class="ident">when</span>, <span class="ident">then</span><span class="op">|</span> {
    <span class="ident">when</span>.<span class="ident">path</span>(<span class="string">&quot;/hi&quot;</span>);
    <span class="ident">then</span>.<span class="ident">status</span>(<span class="number">200</span>);
});

<span class="kw">let</span> <span class="ident">response</span> <span class="op">=</span> <span class="ident">isahc::get</span>(<span class="ident">server</span>.<span class="ident">url</span>(<span class="string">&quot;/hi&quot;</span>)).<span class="ident">unwrap</span>();

<span class="ident">greeting_mock</span>.<span class="ident">assert</span>();</code></pre></div>
<p>Note that <code>when</code> and <code>then</code> are variables. This allows you to rename them to something you
like better (such as <code>expect</code>/<code>respond_with</code>).</p>
<p>Relevant elements for this API are <a href="struct.MockServer.html#method.mock">MockServer::mock</a>, <a href="struct.When.html">When</a> and <a href="struct.Then.html">Then</a>.</p>
<h2 id="examples" class="section-header"><a href="#examples">Examples</a></h2>
<p>You can find examples in the test directory in this crates Git repository:
<a href="https://github.com/alexliesenfeld/httpmock/blob/master/tests">this crates test directory</a>.</p>
<h2 id="standalone-mode" class="section-header"><a href="#standalone-mode">Standalone Mode</a></h2>
<p>You can use <code>httpmock</code> to run a standalone mock server that runs in a separate process.
This allows it to be available to multiple applications, not only inside your unit and integration
tests. This is useful if you want to use <code>httpmock</code> in system (or even end-to-end) tests, that
require mocked services. With this feature, <code>httpmock</code> is a universal HTTP mocking tool that is
useful in all stages of the development lifecycle.</p>
<h3 id="using-a-standalone-mock-server" class="section-header"><a href="#using-a-standalone-mock-server">Using a Standalone Mock Server</a></h3>
<p>Although you can build the mock server in standalone mode yourself, it is easiest to use the
accompanying <a href="https://hub.docker.com/r/alexliesenfeld/httpmock">Docker image</a>.</p>
<p>To be able to use the standalone server from within your tests, you need to change how an
instance of the <a href="struct.MockServer.html">MockServer</a> instance is created.
Instead of using <a href="struct.MockServer.html#method.start">MockServer::start</a>,
you need to connect to a remote server by using one of the <code>connect</code> methods (such as
<a href="struct.MockServer.html#method.connect">MockServer::connect</a> or
<a href="struct.MockServer.html#method.connect_from_env">MockServer::connect_from_env</a>).</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">httpmock</span>::{<span class="ident">MockServer</span>, <span class="ident">Mock</span>};
<span class="kw">use</span> <span class="ident">isahc::get</span>;

<span class="attribute">#[<span class="ident">test</span>]</span>
<span class="kw">fn</span> <span class="ident">simple_test</span>() {
    <span class="comment">// Arrange</span>
    <span class="kw">let</span> <span class="ident">server</span> <span class="op">=</span> <span class="ident">MockServer::connect</span>(<span class="string">&quot;some-host:5000&quot;</span>);

    <span class="kw">let</span> <span class="ident">hello_mock</span> <span class="op">=</span> <span class="ident">server</span>.<span class="ident">mock</span>(<span class="op">|</span><span class="ident">when</span>, <span class="ident">then</span><span class="op">|</span>{
        <span class="ident">when</span>.<span class="ident">path</span>(<span class="string">&quot;/hello/standalone&quot;</span>);
        <span class="ident">then</span>.<span class="ident">status</span>(<span class="number">200</span>);
    });

    <span class="comment">// Act</span>
    <span class="kw">let</span> <span class="ident">response</span> <span class="op">=</span> <span class="ident">get</span>(<span class="ident">server</span>.<span class="ident">url</span>(<span class="string">&quot;/hello/standalone&quot;</span>)).<span class="ident">unwrap</span>();

    <span class="comment">// Assert</span>
    <span class="ident">hello_mock</span>.<span class="ident">assert</span>();
    <span class="macro">assert_eq!</span>(<span class="ident">response</span>.<span class="ident">status</span>(), <span class="number">200</span>);
}</code></pre></div>
<h3 id="standalone-parallelism" class="section-header"><a href="#standalone-parallelism">Standalone Parallelism</a></h3>
<p>To prevent interference with other tests, test functions are forced to use the standalone
mock server sequentially.
This means that test functions may be blocked when connecting to the remote server until
it becomes free again.
This is in contrast to tests that use a local mock server.</p>
<h3 id="limitations-of-the-standalone-mode" class="section-header"><a href="#limitations-of-the-standalone-mode">Limitations of the Standalone Mode</a></h3>
<p>At this time, it is not possible to use custom request matchers in combination with standalone
mock servers (see <a href="struct.When.html#method.matches">When::matches</a> or
<a href="struct.Mock.html#method.expect_match">Mock::expect_match</a>).</p>
<h3 id="standalone-mode-with-yaml-mock-definition-files" class="section-header"><a href="#standalone-mode-with-yaml-mock-definition-files">Standalone Mode with YAML Mock Definition Files</a></h3>
<p>The standalone server can also be used to read mock definitions from YAML files on startup once
and serve the mocked endpoints until the server is shut down again. These <code>static</code> mocks
cannot be deleted at runtime (even by Rust-based tests that use the mock server) and exist
for the entire uptime of the mock server.</p>
<p>The definition files follow the standard <code>httpmock</code> API that you would also use in regular
Rust tests. Please find an example mock definition file in the <code>httpmock</code> Github repository
<a href="https://github.com/alexliesenfeld/httpmock/blob/master/tests/resources/static_yaml_mock.yaml">here in this crates test directory</a>.</p>
<p>You can start the mock server with static mock support as follows:</p>
<ul>
<li>If you use the <a href="https://github.com/alexliesenfeld/httpmock/blob/master/Dockerfile">Docker image from this creates repository</a>
or from <a href="https://hub.docker.com/r/alexliesenfeld/httpmock">Dockerhub</a>, you just need to mount a
volume with all your mock specification files to the <code>/mocks</code> directory within the container.</li>
<li>If you build <code>httpmock</code> from source and use the binary, then you can pass the path to
the directory containing all your mock specification files using the <code>--static-mock-dir</code>
parameter. Example: <code>httpmock --expose --static-mock-dir=/mocks</code>.</li>
</ul>
<h2 id="license" class="section-header"><a href="#license">License</a></h2>
<p><code>httpmock</code> is free software: you can redistribute it and/or modify it under the terms
of the MIT Public License.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the MIT Public
License for more details.</p>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="standalone/index.html" title="httpmock::standalone mod">standalone</a></div><div class="item-right docblock-short"></div></div></div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.HttpMockRequest.html" title="httpmock::HttpMockRequest struct">HttpMockRequest</a></div><div class="item-right docblock-short"><p>A general abstraction of an HTTP request of <code>httpmock</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Mock.html" title="httpmock::Mock struct">Mock</a><span class="stab deprecated" title="">Deprecated</span></div><div class="item-right docblock-short"><p>The <a href="struct.Mock.html">Mock</a> structure holds a definition for a request/response scenario
that can be used to configure a <a href="struct.MockServer.html">MockServer</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MockRef.html" title="httpmock::MockRef struct">MockRef</a></div><div class="item-right docblock-short"><p>Represents a reference to the mock object on a <a href="struct.MockServer.html">MockServer</a>.
It can be used to spy on the mock and also perform some management operations, such as
deleting the mock from the <a href="struct.MockServer.html">MockServer</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MockServer.html" title="httpmock::MockServer struct">MockServer</a></div><div class="item-right docblock-short"><p>A mock server that is able to receive and respond to HTTP requests.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.NameValuePair.html" title="httpmock::NameValuePair struct">NameValuePair</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Then.html" title="httpmock::Then struct">Then</a></div><div class="item-right docblock-short"><p>A type that allows the specification of HTTP response values.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.When.html" title="httpmock::When struct">When</a></div><div class="item-right docblock-short"><p>A type that allows the specification of HTTP request values.</p>
</div></div></div><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Method.html" title="httpmock::Method enum">Method</a></div><div class="item-right docblock-short"><p>Represents an HTTP method.</p>
</div></div></div><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.MockRefExt.html" title="httpmock::MockRefExt trait">MockRefExt</a></div><div class="item-right docblock-short"><p>The <a href="trait.MockRefExt.html">MockRefExt</a> trait extends the <a href="struct.MockRef.html">MockRef</a>
structure with some additional functionality, that is usually not required.</p>
</div></div></div><h2 id="types" class="section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.MockMatcherFunction.html" title="httpmock::MockMatcherFunction type">MockMatcherFunction</a></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Regex.html" title="httpmock::Regex type">Regex</a></div><div class="item-right docblock-short"><p>Type alias for <a href="../regex/struct.Regex.html">regex::Regex</a>.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="httpmock" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>