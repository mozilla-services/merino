<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Typically internal client methods for sending metrics and handling errors."><meta name="keywords" content="rust, rustlang, rust-lang, MetricBackend"><title>MetricBackend in cadence::ext - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../cadence/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../cadence/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">MetricBackend</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.consume_error">consume_error</a></li><li><a href="#tymethod.send_metric">send_metric</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In cadence::ext</a></h2><div id="sidebar-vars" data-name="MetricBackend" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../cadence/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="../index.html">cadence</a>::<wbr><a href="index.html">ext</a>::<wbr><a class="trait" href="#">MetricBackend</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/cadence/client.rs.html#535-559">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait MetricBackend: Sealed {
    fn <a href="#tymethod.send_metric" class="fnname">send_metric</a>&lt;M&gt;(&amp;self, metric: <a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.reference.html">&amp;</a>M) -&gt; <a class="type" href="../type.MetricResult.html" title="type cadence::MetricResult">MetricResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>&gt;<br>&nbsp;&nbsp;&nbsp; <span class="where">where<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M: <a class="trait" href="../trait.Metric.html" title="trait cadence::Metric">Metric</a></span>;
<span class="item-spacer"></span>    fn <a href="#tymethod.consume_error" class="fnname">consume_error</a>(&amp;self, err: <a class="struct" href="../struct.MetricError.html" title="struct cadence::MetricError">MetricError</a>);
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Typically internal client methods for sending metrics and handling errors.</p>
<p>This trait exposes methods of the client that would normally be internal
but may be useful for consumers of the library to extend it in unforseen
ways. Most consumers of the library shouldn’t need to make use of this
extension point.</p>
<p>This trait is not exposed in the <code>prelude</code> module since it isn’t required
to use the client for sending metrics. It is only exposed in the <code>ext</code>
module which is used to encompass advanced extension points for the library.</p>
<p>NOTE: This is a sealed trait and so it cannot be implemented outside of the
library.</p>
<h2 id="example"><a href="#example">Example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">cadence</span>::{<span class="ident">Metric</span>, <span class="ident">MetricResult</span>, <span class="ident">StatsdClient</span>, <span class="ident">NopMetricSink</span>};
<span class="kw">use</span> <span class="ident">cadence::ext::MetricBackend</span>;

<span class="kw">struct</span> <span class="ident">CustomMetric</span> {
    <span class="ident">repr</span>: <span class="ident">String</span>,
}

<span class="kw">impl</span> <span class="ident">Metric</span> <span class="kw">for</span> <span class="ident">CustomMetric</span> {
    <span class="kw">fn</span> <span class="ident">as_metric_str</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;</span><span class="ident">str</span> {
        <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">repr</span>
    }
}

<span class="kw">impl</span> <span class="ident">From</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">CustomMetric</span> {
    <span class="kw">fn</span> <span class="ident">from</span>(<span class="ident">v</span>: <span class="ident">String</span>) -&gt; <span class="self">Self</span> {
        <span class="ident">CustomMetric</span> { <span class="ident">repr</span>: <span class="ident">v</span> }
    }
}

<span class="kw">struct</span> <span class="ident">MyCustomClient</span> {
    <span class="ident">prefix</span>: <span class="ident">String</span>,
    <span class="ident">wrapped</span>: <span class="ident">StatsdClient</span>,
}

<span class="kw">impl</span> <span class="ident">MyCustomClient</span> {
    <span class="kw">fn</span> <span class="ident">new</span>(<span class="ident">prefix</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>, <span class="ident">client</span>: <span class="ident">StatsdClient</span>) -&gt; <span class="self">Self</span> {
        <span class="ident">MyCustomClient</span> {
            <span class="ident">prefix</span>: <span class="ident">prefix</span>.<span class="ident">to_string</span>(),
            <span class="ident">wrapped</span>: <span class="ident">client</span>,
        }
    }

    <span class="kw">fn</span> <span class="ident">send_event</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">key</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>, <span class="ident">val</span>: <span class="ident">i64</span>) -&gt; <span class="ident">MetricResult</span><span class="op">&lt;</span><span class="ident">CustomMetric</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">metric</span> <span class="op">=</span> <span class="ident">CustomMetric::from</span>(<span class="macro">format!</span>(<span class="string">&quot;{}.{}:{}|e&quot;</span>, <span class="self">self</span>.<span class="ident">prefix</span>, <span class="ident">key</span>, <span class="ident">val</span>));
        <span class="self">self</span>.<span class="ident">wrapped</span>.<span class="ident">send_metric</span>(<span class="kw-2">&amp;</span><span class="ident">metric</span>)<span class="question-mark">?</span>;
        <span class="prelude-val">Ok</span>(<span class="ident">metric</span>)
    }

    <span class="kw">fn</span> <span class="ident">send_event_quietly</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">key</span>: <span class="kw-2">&amp;</span><span class="ident">str</span>, <span class="ident">val</span>: <span class="ident">i64</span>) {
        <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span> <span class="self">self</span>.<span class="ident">send_event</span>(<span class="ident">key</span>, <span class="ident">val</span>) {
            <span class="self">self</span>.<span class="ident">wrapped</span>.<span class="ident">consume_error</span>(<span class="ident">e</span>);
        }
    }
}

<span class="kw">let</span> <span class="ident">prefix</span> <span class="op">=</span> <span class="string">&quot;some.prefix&quot;</span>;
<span class="kw">let</span> <span class="ident">inner</span> <span class="op">=</span> <span class="ident">StatsdClient::from_sink</span>(<span class="kw-2">&amp;</span><span class="ident">prefix</span>, <span class="ident">NopMetricSink</span>);
<span class="kw">let</span> <span class="ident">custom</span> <span class="op">=</span> <span class="ident">MyCustomClient::new</span>(<span class="kw-2">&amp;</span><span class="ident">prefix</span>, <span class="ident">inner</span>);

<span class="ident">custom</span>.<span class="ident">send_event</span>(<span class="string">&quot;some.event&quot;</span>, <span class="number">123</span>).<span class="ident">unwrap</span>();
<span class="ident">custom</span>.<span class="ident">send_event_quietly</span>(<span class="string">&quot;some.event&quot;</span>, <span class="number">456</span>);</code></pre></div>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.send_metric" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/cadence/client.rs.html#545-547">source</a></div><h4 class="code-header">fn <a href="#tymethod.send_metric" class="fnname">send_metric</a>&lt;M&gt;(&amp;self, metric: <a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.reference.html">&amp;</a>M) -&gt; <a class="type" href="../type.MetricResult.html" title="type cadence::MetricResult">MetricResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.62.1/std/primitive.unit.html">()</a>&gt; <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;M: <a class="trait" href="../trait.Metric.html" title="trait cadence::Metric">Metric</a>,&nbsp;</span></h4></div></summary><div class="docblock"><p>Send a full formed <code>Metric</code> implementation via the underlying <code>MetricSink</code></p>
<p>Obtain a <code>&amp;str</code> representation of a metric, encode it as UTF-8 bytes, and
send it to the underlying <code>MetricSink</code>, verbatim. Note that the metric is
expected to be full formed already, including any prefix or tags.</p>
<p>Note that if you simply want to emit standard metrics, you don’t need to
use this method. This is only useful if you are extending Cadence with a
custom metric type or something similar.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.consume_error" class="method has-srclink"><div class="rightside"><a class="srclink" href="../../src/cadence/client.rs.html#558">source</a></div><h4 class="code-header">fn <a href="#tymethod.consume_error" class="fnname">consume_error</a>(&amp;self, err: <a class="struct" href="../struct.MetricError.html" title="struct cadence::MetricError">MetricError</a>)</h4></div></summary><div class="docblock"><p>Consume a possible error from attempting to send a metric.</p>
<p>When callers have elected to quietly send metrics via the <code>MetricBuilder::send()</code>
method, this method will be invoked if an error is encountered. By default the
handler is a no-op, meaning that errors are discarded.</p>
<p>Note that if you simply want to emit standard metrics, you don’t need to
use this method. This is only useful if you are extending Cadence with a
custom metric type or something similar.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><section id="impl-MetricBackend" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../../src/cadence/client.rs.html#916-929">source</a></span><a href="#impl-MetricBackend" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.MetricBackend.html" title="trait cadence::ext::MetricBackend">MetricBackend</a> for <a class="struct" href="../struct.StatsdClient.html" title="struct cadence::StatsdClient">StatsdClient</a></h3></section></div><script type="text/javascript" src="../../implementors/cadence/client/trait.MetricBackend.js" data-ignore-extern-crates="" async></script></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="cadence" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.1 (e092d0b6b 2022-07-16)" ></div>
</body></html>