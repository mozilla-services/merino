<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Using the HTTP API - Merino Book</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Intro</a></li><li class="chapter-item expanded affix "><li class="part-title">General Documentation</li><li class="chapter-item expanded "><a href="api.html" class="active"><strong aria-hidden="true">1.</strong> Using the HTTP API</a></li><li class="chapter-item expanded "><a href="firefox.html"><strong aria-hidden="true">2.</strong> Configuring Firefox and Merino Environments</a></li><li class="chapter-item expanded "><a href="ops.html"><strong aria-hidden="true">3.</strong> Configuring Merino (Operations)</a></li><li class="chapter-item expanded "><a href="data.html"><strong aria-hidden="true">4.</strong> Data collection</a></li><li class="chapter-item expanded "><a href="dev/index.html"><strong aria-hidden="true">5.</strong> Working on the code</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dev/showroom.html"><strong aria-hidden="true">5.1.</strong> Merino Showroom</a></li><li class="chapter-item expanded "><a href="dev/logging-and-metrics.html"><strong aria-hidden="true">5.2.</strong> Logging and Metrics</a></li><li class="chapter-item expanded "><a href="dev/testing.html"><strong aria-hidden="true">5.3.</strong> Testing Strategies</a></li><li class="chapter-item expanded "><a href="dev/dependencies.html"><strong aria-hidden="true">5.4.</strong> Development Dependencies</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Architecture Decision Records</li><li class="chapter-item expanded affix "><a href="adrs/adr_0001_logging.html">ADR 0001 - Logging</a></li><li class="chapter-item expanded affix "><a href="adrs/adr_0002_hashing.html">ADR 0002 - Hashing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Merino Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="merino-api-documentation"><a class="header" href="#merino-api-documentation">Merino API documentation</a></h1>
<p>This page describes the API endpoints available on Merino.</p>
<h2 id="suggest"><a class="header" href="#suggest">Suggest</a></h2>
<p>Endpoint: <code>/api/v1/suggest</code></p>
<p>Example: <code>/api/v1/suggest?q=nelson%20mand&amp;client_variants=one,two</code></p>
<p>The primary endpoint for the browser to consume, this endpoint consumes user
input and suggests pages the user may want to visit. The expectation is that
this is shown alongside other content the browser suggests to the user, such as
bookmarks and history.</p>
<p>This endpoint accepts GET requests and takes parameters as query string values
and headers.</p>
<h3 id="query-parameters"><a class="header" href="#query-parameters">Query Parameters</a></h3>
<ul>
<li>
<p><code>q</code> - The query that the user has typed. This is expected to be a partial
input, sent as fast as once per keystroke, though a slower period may be
appropriate for the user agent.</p>
</li>
<li>
<p><code>client_variants</code> - Optional. A comma-separated list of any experiments or
rollouts that are affecting the client's Suggest experience. If Merino
recognizes any of them it will modify its behavior accordingly.</p>
</li>
<li>
<p><code>providers</code> - Optional. A comma-separated list of providers to use for this
request. See the <code>/providers</code> endpoint below for valid options. If provided,
only suggestions from the listed providers will be returned. If not provided,
Merino will use a built-in default set of providers. The default set of
providers can be seen in the <code>/providers</code> endpoint.</p>
</li>
</ul>
<h3 id="headers"><a class="header" href="#headers">Headers</a></h3>
<ul>
<li>
<p><code>Accept-Language</code> - The locale preferences expressed in this header in
accordance with <a href="https://datatracker.ietf.org/doc/html/rfc2616/#section-14.4">RFC 2616 section 14.4</a> will be used to
determine suggestions. Merino maintains a list of supported locales. Merino
will choose the locale from it's list that has the highest <code>q</code> (quality) value
in the user's <code>Accept-Language</code> header. Locales with <code>q=0</code> will not be used.</p>
<p>If no locales match, Merino will not return any suggestions. If the header is
not included or empty, Merino will default to the <code>en-US</code> locale.</p>
<p>If the highest quality, compatible language produces no suggestion results,
Merino will return an empty list instead of attempting to query other
languages.</p>
</li>
<li>
<p><code>User-Agent</code> - A user's device form factor, operating system, and
browser/Firefox version are detected from the <code>User-Agent</code> header included in
the request.</p>
</li>
</ul>
<h3 id="other-derived-inputs"><a class="header" href="#other-derived-inputs">Other derived inputs</a></h3>
<ul>
<li>
<p>Location - The IP address of the user or nearest proxy will be used to
determine location. This location may be as granular as city level, depending
on server configuration.</p>
<p>Users that use VPN services will be identified according to the VPN exit node
they use, allowing them to change Merino's understanding of their location.
VPN exit nodes are often mis-identified in geolocation databases, and may
produce unreliable results.</p>
</li>
</ul>
<h3 id="response"><a class="header" href="#response">Response</a></h3>
<h4 id="response-object"><a class="header" href="#response-object">Response object</a></h4>
<p>The response will be a JSON object containing the following keys:</p>
<ul>
<li><code>client_variants</code> - A list of strings specified from the <code>client_variants</code>
parameter in the request.</li>
<li><code>server_variants</code> - A list of strings indicating the server variants.</li>
<li><code>request_id</code> - A string identifier identifying every API request sent from Firefox.</li>
<li><code>suggestions</code> - A list of suggestion objects described as below.</li>
</ul>
<h4 id="suggestion-object"><a class="header" href="#suggestion-object">Suggestion object</a></h4>
<ul>
<li>
<p><code>block_id</code> - a number that can be used, along with the <code>provider</code> field below,
to uniquely identify this suggestion. Two suggestions with the same <code>provider</code>
and <code>block_id</code> should be treated as the same suggestion, even if other fields,
such as <code>click_url</code> change. Merino will enforce that they are equivalent from
a user's point of view.</p>
</li>
<li>
<p><code>full_keyword</code> - In the case that the query was a partial match to the
suggestion, this is the completed query that would also match this query. For
example, if the user was searching for fruit and typed &quot;appl&quot;, this field
might contain the string &quot;apples&quot;. This is suitable to show as a completion of
the user's input. This field should be treated as plain text.</p>
</li>
<li>
<p><code>title</code> - The full title of the suggestion resulting from the query. Using the
example of apples above, this might be &quot;Types of Apples in the Pacific
Northwest&quot;. This field should be treated as plain text.</p>
</li>
<li>
<p><code>url</code> - The URL of the page that should be navigated to if the user selects
this suggestion. This will be a resource with the title specified in the
<code>title</code> field.</p>
</li>
<li>
<p><code>impression_url</code> - A provider specified telemetry URL that should be notified
if the browser shows this suggestion to the user. This is used along with
<code>click_url</code> to monitor the relevancy of suggestions. For more details see
<a href="#interaction-pings">Interaction Pings</a>, below. This field may be null, in
which case no impression ping is required for this suggestion provider.</p>
</li>
<li>
<p><code>click_url</code> - A provider specified telemetry URL that should be notified if
the user selects this suggestion. This should only be notified as the result
of positive user action, and only if the user has navigated to the page
specified in the <code>url</code> field. For more details see
<a href="#interaction-pings">Interaction Pings</a>, below. This field may be null, in
which case no click ping is required for this suggestion provider.</p>
</li>
<li>
<p><code>provider</code> - A string that identifies the provider of this suggestion, such as
&quot;adM&quot;. In general, this field is not intended to be directly displayed to the user.</p>
</li>
<li>
<p><code>advertiser</code> - The name of the advertiser, such as &quot;Nike&quot;. Note that a <code>provider</code>
could have multiple <code>advertiser</code>s.</p>
</li>
<li>
<p><code>is_sponsored</code> - A boolean indicating if this suggestion is sponsored content.
If this is true, the UI must indicate to the user that the suggestion is
sponsored.</p>
</li>
<li>
<p><code>icon</code> - A URL of an image to display alongside the suggestion. This will be a
small square image, suitable to be included inline with the text, such as a
site's favicon.</p>
</li>
<li>
<p><code>score</code> - A value between 0.0 and 1.0 used to compare suggestions. When
choosing a suggestion to show the user, higher scored suggestions are
preferred.</p>
</li>
</ul>
<h3 id="response-headers"><a class="header" href="#response-headers">Response Headers</a></h3>
<p>Responses will carry standard HTTP caching headers that indicate the validity of
the suggestions. User agents should prefer to provide the user with cached
results as indicated by these headers.</p>
<h3 id="response-status-codes"><a class="header" href="#response-status-codes">Response Status Codes</a></h3>
<ul>
<li>200 OK - Suggestions provided normally.</li>
<li>4xx - Client error. See response for details.</li>
<li>5xx - Internal server error. Try again later.</li>
</ul>
<p><a id="interaction-pings"></a></p>
<h2 id="interaction-pings"><a class="header" href="#interaction-pings">Interaction Pings</a></h2>
<p>When a Firefox user views or selects a suggestion from Merino, Firefox will send
an impression or a click ping to a Mozilla-controlled service indicating this
user interaction. Some suggestion providers may also need that interaction data
for reporting and relevancy optimization. Firefox will not send the pings to
those providers directly, rather, it will delegate those to a Mozilla-controlled
service, by which the interaction pings will be sent to the <code>impression_url</code> or
<code>click_url</code> specified by the providers.</p>
<p>If the URL for an interaction ping is not specified (for example, <code>click_url</code> is
<code>null</code>), then no ping should be sent to the provider for that action. However,
this interaction ping is always sent to the Mozilla-controlled service unless
the user opts out the telemetry collection of Firefox.</p>
<p>The required behavior for interaction pings is TBD.</p>
<h2 id="providers"><a class="header" href="#providers">Providers</a></h2>
<p>Endpoint: <code>/api/v1/providers</code></p>
<p>This endpoint gives a list of available providers, along with their
<em>availability</em>. It accepts GET requests and takes no parameters.</p>
<h3 id="response-1"><a class="header" href="#response-1">Response</a></h3>
<p>The response will be a JSON object containing the key <code>providers</code>, which is a
map where the keys to this map are the IDs of the provider, and the values are
provider metadata object. Each provider metadata object will have the following
format:</p>
<ul>
<li>
<p><code>id</code> - A string that can be used to identify this provider. This ID can be
used for the <code>providers</code> field of the suggest API.</p>
</li>
<li>
<p><code>availability</code> - A string describing how this provider is used in Merino. It
will be one of:</p>
<ul>
<li><code>&quot;enabled_by_default&quot;</code> - This provider will be used for requests that don't
specify providers, and it should be provided to the user as a selection that
can be turned off.</li>
<li><code>&quot;disabled_by_default&quot;</code> - This provider is not used automatically. It should
be provided to the user as a selection that could be turned on.</li>
<li><code>&quot;hidden&quot;</code> - This provider is not used automatically. It should not be
provided to the user as an option to turn on. It may be used for debugging
or other internal uses. */</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="firefox.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="firefox.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
